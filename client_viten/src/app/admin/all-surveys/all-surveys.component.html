<div class="searchBox">
  <md-input-container class="search">
    <input mdInput type="search"
            placeholder="{{'Search' | translate}}"
            [formControl]="searchFormControl"
            [(value)]="searchInput"
            md-tooltip="{{ 'Filter results on title and / or admin comment' | translate }}">
    <span md-prefix><md-icon class="searchIcon">search</md-icon></span>
  </md-input-container>
</div>
<button md-mini-fab
  class="addButton"
  color="primary"
  routerLink="/admin/editsurvey"
  routerLinkActive="active"
  md-tooltip="{{ 'Create New Survey' | translate }}">
  <md-icon>add</md-icon>
</button>

<md-progress-spinner *ngIf="searchLoading" mode="indeterminate" class="loadingCircle" color="primary"></md-progress-spinner>



<div class="treeArea">
  <ul *ngIf="!loading" class="tree">
    <ng-template #recursiveList let-node>
      <li class="folder item" [ngClass]="{ 'open': node.open, 'closed': !node.open }" id="{{node._id}}">
        <a class="click" (click)="toggleFolderOpenState($event, node)"><md-icon class="icon">{{ node.open ? 'folder_open' : 'folder'}}</md-icon>{{node.title}}</a>

        <md-menu #folderTasksMenu="mdMenu"  xPosition="after" yPosition="below" [overlapTrigger]="true">
          <button md-menu-item  (click)="copySurvey()">
            translateme: Renmame
          </button>
          <button md-menu-item (click)="createNewFolder(node)">
            translateme: Create subfolder here
          </button>
          <button md-menu-item (click)="copySurvey()">
            translateme: Delete
          </button>
        </md-menu>

        <md-icon class="dotdotdot"  [mdMenuTriggerFor]="folderTasksMenu">more_horiz</md-icon>

        <ul class="items" [dragula]="'folderBag'">
          <li class="survey item" *ngFor="let survey of node.surveys" id="{{survey._id}}">
            <a routerLink="/admin/{{survey._id}}" class="click"><md-icon class="icon">insert_chart</md-icon>{{survey.name}}</a>
            <span>{{survey.date}}</span>
          </li>
          <ng-container *ngFor="let subfolder of node.folders">
            <ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: subfolder }"></ng-container>
          </ng-container>
        </ul>
      </li>
    </ng-template>
    <ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: root }"></ng-container>
  </ul>

</div>

<!-- loading circle -->
<md-progress-spinner *ngIf="loading" mode="indeterminate" class="loadingCircle" color="primary"></md-progress-spinner>
